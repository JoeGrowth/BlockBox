<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Workflow Tracker</title>
<!-- Font Awesome CDN -->
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
/>
<style>
  /* Reset & base */
  * {
    box-sizing: border-box;
  }
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 20px;
    background: #f5f7fa;
    color: #333;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  h1 {
    text-align: center;
    margin-bottom: 2rem;
    font-weight: 700;
    font-size: 2rem;
    color: #2a4d1b;
    text-shadow: 0 1px 1px rgba(58, 163, 77, 0.3);
  }

  h2 {
    margin-top: 0;
    margin-bottom: 1rem;
    font-weight: 700;
    font-size: 1.3rem;
    text-align: center;
    color: #276327;
    user-select: none;
  }

  /* Container holding all columns */
  .workflow-container {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 15px;
  max-width: 900px; /* Optional max width */
  margin: 0 auto; /* Center horizontally */
}

.card {
  background: white;
  border-radius: 10px;
  box-shadow: 0 2px 7px rgb(0 0 0 / 0.1);
  padding: 1rem;
  flex: 0 0 calc(33.333% - 10px); /* Exactly 3 per row with some gap */
  max-width: calc(33.333% - 10px);
  display: flex;
  flex-direction: column;
  min-height: 400px;
}

/* Responsive */
@media (max-width: 900px) {
  .workflow-container {
    max-width: 100%;
  }
  .card {
    flex: 0 0 90vw; /* almost full width on small screens */
    max-width: 90vw;
    min-height: auto;
  }
}

  /* Highlight border when dragging over */
  .card.drag-over {
    border: 3px dashed #3ba34d;
    box-shadow: 0 0 15px 3px rgba(59, 163, 77, 0.35);
  }

  /* Add Opportunity input and button */
  .add-opportunity {
    display: flex;
    margin-bottom: 1.25rem;
    gap: 0.75rem;
  }

  .add-opportunity input {
    flex: 1;
    padding: 0.65rem 1rem;
    border: 1.8px solid #a1c99a;
    border-radius: 8px;
    font-size: 1rem;
    transition: border-color 0.3s ease;
  }
  .add-opportunity input:focus {
    border-color: #3ba34d;
    outline: none;
    box-shadow: 0 0 6px rgba(59, 163, 77, 0.5);
  }

  .add-opportunity button {
    background: #3ba34d;
    color: white;
    border: none;
    border-radius: 8px;
    padding: 0 1.25rem;
    font-weight: 700;
    font-size: 1rem;
    cursor: pointer;
    transition: background-color 0.25s ease, box-shadow 0.25s ease;
    box-shadow: 0 3px 7px rgba(44, 119, 44, 0.6);
  }
  .add-opportunity button:hover,
  .add-opportunity button:focus {
    background: #329739;
    box-shadow: 0 5px 12px rgba(44, 119, 44, 0.9);
    outline: none;
  }

  /* Opportunities list */
  .opportunities-list {
    flex-grow: 1;
    overflow-y: auto;
    min-height: 60px;
    padding-right: 4px;
    scrollbar-width: thin;
    scrollbar-color: #a0d48a #f0f4f0;
  }
  .opportunities-list::-webkit-scrollbar {
    width: 7px;
  }
  .opportunities-list::-webkit-scrollbar-track {
    background: #f0f4f0;
    border-radius: 8px;
  }
  .opportunities-list::-webkit-scrollbar-thumb {
    background-color: #a0d48a;
    border-radius: 8px;
  }

  /* Individual opportunity items */
  .opportunity {
    background-color: #3ba34d;
    color: white;
    border-radius: 12px;
    margin-bottom: 0.7rem;
    padding: 0.5rem 0.85rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    cursor: grab;
    user-select: none;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    transition: background-color 0.3s ease, box-shadow 0.3s ease;
  }
  .opportunity:active {
    cursor: grabbing;
  }
  .opportunity:hover {
    background-color: #329739;
    box-shadow: 0 3px 12px rgba(0, 0, 0, 0.12);
  }

  .opportunity .text {
    flex: 1;
    padding-right: 0.6rem;
    word-break: break-word;
    font-weight: 600;
    font-size: 1rem;
  }

  .opportunity .actions {
    display: flex;
    gap: 0.6rem;
  }

  .opportunity .actions button {
    background: transparent;
    border: none;
    color: white;
    font-size: 1.2rem;
    cursor: pointer;
    padding: 0.15rem;
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: color 0.3s ease, background-color 0.25s ease;
  }
  .opportunity .actions button:hover,
  .opportunity .actions button:focus {
    color: #d1f2d1;
    background-color: rgba(255 255 255 / 0.15);
    outline: none;
  }

  /* Editable text input inside opportunity */
  .opportunity.editing .text {
    display: none;
  }
  .opportunity.editing input.edit-input {
    flex: 1;
    font-size: 1rem;
    border-radius: 8px;
    border: 2px solid #2c7a2c;
    padding: 0.3rem 0.6rem;
    box-shadow: 0 0 8px rgba(44, 119, 44, 0.6);
  }
  .opportunity.editing input.edit-input:focus {
    outline: none;
    border-color: #3ba34d;
  }

  /* Responsive */
  @media (max-width: 900px) {
    .workflow-container {
      flex-direction: column;
      align-items: center;
    }
    .card {
      max-width: 95vw;
      min-height: auto;
      padding: 1rem 1.2rem;
    }
  }

  @media (max-width: 400px) {
    .add-opportunity input {
      font-size: 0.9rem;
    }
    .add-opportunity button {
      font-size: 0.9rem;
      padding: 0 0.85rem;
    }
    .opportunity .actions button {
      font-size: 1rem;
    }
  }
</style>
</head>
<body>

<h1>Workflow Tracker</h1>

<div class="workflow-container" id="workflowContainer">
  <!-- Columns will be injected here -->
</div>

<script>
(() => {
  const columns = [
    'List of Opportunities',
    'Waiting For Offer Approval',
    'Delivery Mode',
    'Delivery Approval',
    'Consider it a Service',
    'Add to Service Catalog'
  ];

  const STORAGE_KEY = 'workflowTrackerData';
  let opportunities = [];
  const workflowContainer = document.getElementById('workflowContainer');

  function generateId() {
    return 'opp_' + Math.random().toString(36).substr(2, 9);
  }

  function saveState() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(opportunities));
  }

  function loadState() {
    const data = localStorage.getItem(STORAGE_KEY);
    if (data) {
      try {
        opportunities = JSON.parse(data);
      } catch {
        opportunities = [];
      }
    }
  }

  function render() {
    workflowContainer.innerHTML = '';

    columns.forEach(stage => {
      const card = document.createElement('section');
      card.className = 'card';
      card.dataset.stage = stage;

      const title = document.createElement('h2');
      title.textContent = stage;
      card.appendChild(title);

      if (stage === 'List of Opportunities') {
        const addWrapper = document.createElement('div');
        addWrapper.className = 'add-opportunity';

        const input = document.createElement('input');
        input.type = 'text';
        input.placeholder = 'New opportunity name';
        input.id = 'newOpportunityInput';
        input.autocomplete = 'off';
        input.setAttribute('aria-label', 'New opportunity name');

        const button = document.createElement('button');
        button.textContent = 'Add Opportunity';
        button.id = 'addOpportunityBtn';
        button.setAttribute('aria-label', 'Add Opportunity');

        addWrapper.appendChild(input);
        addWrapper.appendChild(button);
        card.appendChild(addWrapper);

        button.addEventListener('click', () => {
          const val = input.value.trim();
          if (val) {
            addOpportunity(val);
            input.value = '';
            input.focus();
          }
        });

        input.addEventListener('keydown', (e) => {
          if (e.key === 'Enter') {
            button.click();
          }
        });
      }

      const list = document.createElement('div');
      list.className = 'opportunities-list';
      list.dataset.stage = stage;
      list.setAttribute('tabindex', '0');
      list.addEventListener('dragover', onDragOver);
      list.addEventListener('dragleave', onDragLeave);
      list.addEventListener('drop', onDrop);

      opportunities
        .filter(opp => opp.stage === stage)
        .forEach(opp => {
          list.appendChild(createOpportunityElement(opp));
        });

      card.appendChild(list);
      workflowContainer.appendChild(card);
    });
  }

  function createOpportunityElement(opp) {
    const oppDiv = document.createElement('div');
    oppDiv.className = 'opportunity';
    oppDiv.draggable = true;
    oppDiv.dataset.id = opp.id;
    oppDiv.setAttribute('role', 'listitem');

    const textSpan = document.createElement('span');
    textSpan.className = 'text';
    textSpan.textContent = opp.name;
    oppDiv.appendChild(textSpan);

    const editInput = document.createElement('input');
    editInput.type = 'text';
    editInput.className = 'edit-input';
    editInput.value = opp.name;
    editInput.style.display = 'none';
    oppDiv.appendChild(editInput);

    const actions = document.createElement('div');
    actions.className = 'actions';

    const editBtn = document.createElement('button');
    editBtn.title = 'Edit';
    editBtn.setAttribute('aria-label', 'Edit Opportunity');
    editBtn.innerHTML = '<i class="fa fa-pencil"></i>';
    actions.appendChild(editBtn);

    const delBtn = document.createElement('button');
    delBtn.title = 'Delete';
    delBtn.setAttribute('aria-label', 'Delete Opportunity');
    delBtn.innerHTML = '<i class="fa fa-trash"></i>';
    actions.appendChild(delBtn);

    oppDiv.appendChild(actions);

    oppDiv.addEventListener('dragstart', onDragStart);
    oppDiv.addEventListener('dragend', onDragEnd);

    editBtn.addEventListener('click', () => {
      if (oppDiv.classList.contains('editing')) {
        const newVal = editInput.value.trim();
        if (newVal) {
          opp.name = newVal;
          saveState();
          render();
        } else {
          alert('Opportunity name cannot be empty.');
          editInput.focus();
        }
      } else {
        oppDiv.classList.add('editing');
        editInput.style.display = 'inline-block';
        textSpan.style.display = 'none';
        editInput.focus();
        editInput.select();
        editBtn.innerHTML = '<i class="fa fa-check"></i>';
      }
    });

    editInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        editBtn.click();
      } else if (e.key === 'Escape') {
        oppDiv.classList.remove('editing');
        editInput.style.display = 'none';
        textSpan.style.display = 'inline-block';
        editInput.value = opp.name;
        editBtn.innerHTML = '<i class="fa fa-pencil"></i>';
      }
    });

    delBtn.addEventListener('click', () => {
      if (confirm(`Delete opportunity "${opp.name}"?`)) {
        opportunities = opportunities.filter(o => o.id !== opp.id);
        saveState();
        render();
      }
    });

    return oppDiv;
  }

  function addOpportunity(name) {
    const newOpp = {
      id: generateId(),
      name,
      stage: columns[0]
    };
    opportunities.push(newOpp);
    saveState();
    render();
  }

  let draggedId = null;

  function onDragStart(e) {
    draggedId = e.target.dataset.id;
    e.dataTransfer.effectAllowed = 'move';
    e.dataTransfer.setData('text/plain', draggedId);
    e.target.style.opacity = '0.5';
  }

  function onDragEnd(e) {
    draggedId = null;
    e.target.style.opacity = '1';
    document.querySelectorAll('.card.drag-over').forEach(card => {
      card.classList.remove('drag-over');
    });
  }

  function onDragOver(e) {
    e.preventDefault();
    if (!draggedId) return;
    const card = e.currentTarget.closest('.card');
    if (card) card.classList.add('drag-over');
    e.dataTransfer.dropEffect = 'move';
  }

  function onDragLeave(e) {
    const card = e.currentTarget.closest('.card');
    if (card) card.classList.remove('drag-over');
  }

  function onDrop(e) {
    e.preventDefault();
    const card = e.currentTarget.closest('.card');
    if (!card || !draggedId) return;

    const newStage = card.dataset.stage;
    const oppIndex = opportunities.findIndex(o => o.id === draggedId);
    if (oppIndex >= 0) {
      opportunities[oppIndex].stage = newStage;
      saveState();
      render();
    }
    card.classList.remove('drag-over');
    draggedId = null;
  }

  function init() {
    loadState();
    render();
  }

  init();
})();
</script>

</body>
</html>
