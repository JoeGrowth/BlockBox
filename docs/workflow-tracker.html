<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Workflow Tracker</title>
<!-- Font Awesome CDN -->
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
/>
<style>
  /* Reset & base */
  * {
    box-sizing: border-box;
  }
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 20px;
    background: #f5f7fa;
    color: #333;
  }

  h1 {
    text-align: center;
    margin-bottom: 25px;
    font-weight: 700;
  }

  h2 {
    margin-top: 0;
    margin-bottom: 1rem;
    font-weight: 600;
    font-size: 1.2rem;
    text-align: center;
  }

  /* Container holding all columns */
  .workflow-container {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 20px;
    max-width: 1200px; /* wider container */
    margin: 0 auto;
  }

  /* Cards (columns) */
  .card {
    background: white;
    border-radius: 10px;
    box-shadow: 0 2px 7px rgb(0 0 0 / 0.1);
    padding: 1rem;
    flex: 0 0 370px; /* fixed width for wider cards */
    max-width: 370px;
    display: flex;
    flex-direction: column;
    min-height: 420px;
  }

  /* Highlight border when dragging over */
  .card.drag-over {
    border: 3px dashed #3ba34d;
  }

  /* Add Opportunity input and button */
  .add-opportunity {
    display: flex;
    margin-bottom: 1.2rem;
    gap: 1rem;
  }

  .add-opportunity input {
    flex: 1;
    padding: 0.75rem 1rem;
    border: 1.5px solid #ccc;
    border-radius: 8px;
    font-size: 1.15rem;
    outline-offset: 2px;
  }

  .add-opportunity input:focus {
    border-color: #3ba34d;
    box-shadow: 0 0 5px #3ba34daa;
  }

  .add-opportunity button {
    background: #3ba34d;
    color: white;
    border: none;
    border-radius: 8px;
    padding: 0 1.5rem;
    font-weight: 600;
    font-size: 1.15rem;
    cursor: pointer;
    transition: background-color 0.25s ease;
  }
  .add-opportunity button:hover {
    background: #329739;
  }

  /* Opportunities list */
  .opportunities-list {
    flex-grow: 1;
    overflow-y: auto;
    min-height: 50px;
    padding-right: 2px;
  }

  /* Individual opportunity items */
  .opportunity {
    background-color: #3ba34d;
    color: white;
    border-radius: 8px;
    margin-bottom: 0.6rem;
    padding: 0.5rem 0.75rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    cursor: grab;
    user-select: none;
  }
  .opportunity:active {
    cursor: grabbing;
  }

  .opportunity .text {
    flex: 1;
    padding-right: 0.5rem;
    word-break: break-word;
  }

  .opportunity .actions {
    display: flex;
    gap: 0.5rem;
  }

  .opportunity .actions button {
    background: transparent;
    border: none;
    color: white;
    font-size: 1rem;
    cursor: pointer;
    padding: 0;
    display: flex;
    align-items: center;
  }
  .opportunity .actions button:hover {
    color: #d1f2d1;
  }

  /* Editable text input inside opportunity */
  .opportunity.editing .text {
    display: none;
  }
  .opportunity.editing input.edit-input {
    flex: 1;
    font-size: 1rem;
    border-radius: 6px;
    border: 1.5px solid #2c7a2c;
    padding: 0.25rem 0.5rem;
  }

  /* Responsive */
  @media (max-width: 900px) {
    .workflow-container {
      max-width: 100%;
      justify-content: center;
    }
    .card {
      flex: 0 0 90vw;
      max-width: 90vw;
      min-height: auto;
    }
  }
</style>
</head>
<body>

<h1>Workflow Tracker</h1>

<div class="workflow-container" id="workflowContainer">
  <!-- Cards injected here -->
</div>

<script>
(() => {
  const columns = [
    'List of Opportunities',
    'Waiting For Offer Approval',
    'Delivery Mode',
    'Delivery Approval',
    'Consider it a Service',
    'Add to Service Catalog'
  ];

  const STORAGE_KEY = 'workflowTrackerData';
  let opportunities = [];
  const workflowContainer = document.getElementById('workflowContainer');

  function generateId() {
    return 'opp_' + Math.random().toString(36).substr(2, 9);
  }

  function saveState() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(opportunities));
  }

  function loadState() {
    const data = localStorage.getItem(STORAGE_KEY);
    if (data) {
      try {
        opportunities = JSON.parse(data);
      } catch {
        opportunities = [];
      }
    }
  }

  function render() {
    workflowContainer.innerHTML = '';

    columns.forEach(stage => {
      const card = document.createElement('section');
      card.className = 'card';
      card.dataset.stage = stage;

      const title = document.createElement('h2');
      title.textContent = stage;
      card.appendChild(title);

      if (stage === 'List of Opportunities') {
        const addWrapper = document.createElement('div');
        addWrapper.className = 'add-opportunity';

        const input = document.createElement('input');
        input.type = 'text';
        input.placeholder = 'New opportunity name';
        input.id = 'newOpportunityInput';
        input.autocomplete = 'off';

        const button = document.createElement('button');
        button.textContent = 'Add Opportunity';
        button.id = 'addOpportunityBtn';

        addWrapper.appendChild(input);
        addWrapper.appendChild(button);

        card.appendChild(addWrapper);

        button.addEventListener('click', () => {
          const val = input.value.trim();
          if (val) {
            addOpportunity(val);
            input.value = '';
            input.focus();
          }
        });

        input.addEventListener('keydown', (e) => {
          if (e.key === 'Enter') {
            button.click();
          }
        });
      }

      const list = document.createElement('div');
      list.className = 'opportunities-list';
      list.dataset.stage = stage;
      list.addEventListener('dragover', onDragOver);
      list.addEventListener('dragleave', onDragLeave);
      list.addEventListener('drop', onDrop);

      opportunities
        .filter(opp => opp.stage === stage)
        .forEach(opp => {
          list.appendChild(createOpportunityElement(opp));
        });

      card.appendChild(list);
      workflowContainer.appendChild(card);
    });
  }

  function createOpportunityElement(opp) {
    const oppDiv = document.createElement('div');
    oppDiv.className = 'opportunity';
    oppDiv.draggable = true;
    oppDiv.dataset.id = opp.id;

    const textSpan = document.createElement('span');
    textSpan.className = 'text';
    textSpan.textContent = opp.name;
    oppDiv.appendChild(textSpan);

    const editInput = document.createElement('input');
    editInput.type = 'text';
    editInput.className = 'edit-input';
    editInput.value = opp.name;
    editInput.style.display = 'none';
    oppDiv.appendChild(editInput);

    const actions = document.createElement('div');
    actions.className = 'actions';

    const editBtn = document.createElement('button');
    editBtn.title = 'Edit';
    editBtn.innerHTML = '<i class="fa fa-pencil"></i>';
    actions.appendChild(editBtn);

    const delBtn = document.createElement('button');
    delBtn.title = 'Delete';
    delBtn.innerHTML = '<i class="fa fa-trash"></i>';
    actions.appendChild(delBtn);

    oppDiv.appendChild(actions);

    oppDiv.addEventListener('dragstart', onDragStart);
    oppDiv.addEventListener('dragend', onDragEnd);

    editBtn.addEventListener('click', () => {
      if (oppDiv.classList.contains('editing')) {
        const newVal = editInput.value.trim();
        if (newVal) {
          opp.name = newVal;
          saveState();
          render();
        } else {
          alert('Opportunity name cannot be empty.');
          editInput.focus();
        }
      } else {
        oppDiv.classList.add('editing');
        editInput.style.display = 'block';
        textSpan.style.display = 'none';
        editInput.focus();
      }
    });

    editInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        editBtn.click();
      } else if (e.key === 'Escape') {
        oppDiv.classList.remove('editing');
        editInput.style.display = 'none';
        textSpan.style.display = 'block';
      }
    });

    delBtn.addEventListener('click', () => {
      if (confirm(`Delete opportunity "${opp.name}"?`)) {
        opportunities = opportunities.filter(o => o.id !== opp.id);
        saveState();
        render();
      }
    });

    return oppDiv;
  }

  // Drag and drop handlers
  let draggedElement = null;

  function onDragStart(e) {
    draggedElement = this;
    e.dataTransfer.effectAllowed = 'move';
    e.dataTransfer.setData('text/plain', this.dataset.id);
    setTimeout(() => {
      this.style.visibility = 'hidden';
    }, 0);
  }

  function onDragEnd() {
    draggedElement.style.visibility = 'visible';
    draggedElement = null;
    document.querySelectorAll('.card').forEach(c => c.classList.remove('drag-over'));
  }

  function onDragOver(e) {
    e.preventDefault();
    this.closest('.card').classList.add('drag-over');
    e.dataTransfer.dropEffect = 'move';
  }

  function onDragLeave(e) {
    this.closest('.card').classList.remove('drag-over');
  }

  function onDrop(e) {
    e.preventDefault();
    this.closest('.card').classList.remove('drag-over');
    const id = e.dataTransfer.getData('text/plain');
    const opp = opportunities.find(o => o.id === id);
    if (!opp) return;
    const newStage = this.dataset.stage;
    if (opp.stage !== newStage) {
      opp.stage = newStage;
      saveState();
      render();
    }
  }

  // Add new opportunity
  function addOpportunity(name) {
    opportunities.push({ id: generateId(), name, stage: columns[0] });
    saveState();
    render();
  }

  // Init
  loadState();
  render();
})();
</script>

</body>
</html>
